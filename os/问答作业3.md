# 问答作业3

## 实现的功能

* 在进入内核态系统调用后，进入具体系统调用函数前增加任务的系统调用次数
* 在首次运行每个任务前，记录当前任务开始的时间戳
* 在获取任务信息系统调用中，用当前时间戳 - 当前任务开始的时间戳来获取任务运行时长
* 可以通过任务管理器获取每个任务的 TCB 和设置每个任务的 TCB

# 简答作业

1. * ch2b_bad_address 会触发 StoreFault 异常
   * ch2b_bad_instructions 会触发 IllegalInstruction 异常
   * ch2b_bad_register 会触发 IllegalInstruction 异常
2. 
   1. 刚进入 _restore 时，a0 代表当前任务的上下文，或者系统调用的第一个参数；两种场景分别是任务切换，和执行系统调用后从内核态返回用户态
   2. 处理了 sp、t0、t1、t2、spec、sstaus、sscratch 寄存器；其中 sp 代表当前内核态的栈指针，此位置存储着陷入上下文(保存着通用寄存器和 csr 寄存器的值)；t0、t1、t2 用以临时存储从陷入上下文中读出的 sstatus、spec 和 sp 的值，之后用来交换
3.  `tp(x4)` 寄存器，除非我们手动出于一些特殊用途使用它，否则一般也不会被用到；t2 已经在 上面的 L43-L48 处理过，并且写入到了 sscratch 中
4. 这一行之前，sp 指向内核栈，sscratch 指向用户栈，这一行起到交换两者的作用，之后 sp 指向用户栈，sscratch 指向内核栈
5. 状态切换发生在 L61，sret 是具有内核态到用户态的执行环境切换能力的函数返回指令
6. 这一行之前，sp 指向用户栈，sscratch 指向内核栈，这一行起到交换两者的作用，之后 sp 指向内核栈，sscratch 指向用户栈
7. 在用户库系统调用中的 ecall